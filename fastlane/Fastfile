desc 'czpod ç”¨æ¥è‡ªåŠ¨åŒ–å‡çº§ç»´æŠ¤ç§æœ‰åº“'
lane :czpod do |options|

  pod_version = options[:version]
  pod_desc    = options[:desc]
  pod_repoName    = options[:repoName]

  spec = read_podspec
  pod_name = spec["name"]
 
  spec_path   = "#{pod_name}.podspec"
  
  if pod_name.nil? || pod_name.empty? || pod_version.nil? || pod_version.empty?
    UI.message("âŒ é¡¹ç›®åç§°å’Œç‰ˆæœ¬å·æ˜¯å¿…éœ€çš„å‚æ•°")
    exit
  end

  UI.message("ğŸ‘‰ å¼€å§‹å‘å¸ƒç»„ä»¶: #{pod_name} æ–°ç‰ˆæœ¬ä¸º: #{pod_version}")

  git_pull(only_tags: true)
# ç¡®è®¤æ˜¯ masteråˆ†æ”¯
  ensure_git_branch
# ä¿®æ”¹ podspec ä¸­ç‰ˆæœ¬
  version_bump_podspec(path: spec_path, version_number: pod_version)
# æäº¤ä¿®æ”¹
  git_add(path: '.')

  begin
    if pod_desc.nil? || pod_desc.empty?
      git_commit(path: '.', message: "release #{pod_version}")
    else
      git_commit(path: '.', message: pod_desc)
    end
  rescue
    error_message = "#{$!}"
    UI.message("âš ï¸ commit error:#{error_message}")
    unless error_message.include?("nothing to commit, working tree clean")
      exit
    end
    UI.message("æœ¬åœ°ä»£ç å·²æäº¤ï¼Œè°ƒè¿‡æäº¤æ­¥éª¤")
  end

  push_to_git_remote

  if git_tag_exists(tag: pod_version)
      UI.message("Tag #{pod_version} å·²ç»å­˜åœ¨ï¼Œåˆ é™¤è¯¥ Tag ğŸ’¥")
      remove_git_tag(tag: pod_version)
  end
  # æ·»åŠ  tag
  add_git_tag(tag: pod_version)
  # æäº¤tag
  push_git_tags

#---------------------------------æ ¡éªŒä¸æ¨é€æ“ä½œ------------------------------------------------------------------------#
czsource = "http://172.16.69.171/ios/iosspecs.git"
osource = "https://github.com/CocoaPods/Specs.git"


# éªŒè¯spec æ–‡ä»¶
# CZSpecs ä¸ºæœ¬åœ°çš„ä»“åº“åç§°ï¼Œå»ºè®®å…¨éƒ¨ä¿®æ”¹ä¸ºè¿™ä¸ªåå­—
#---------------------------------å¤§éƒ¨åˆ†åœºæ™¯ç”¨çš„------------------#
pod_lib_lint(sources: [czsource,osource], allow_warnings: true, verbose: true,skip_import_validation:true)

 if pod_repoName.nil? || pod_repoName.empty?
    pod_push(path: spec_path, repo: "CZSpecs", sources: [czsource,osource], allow_warnings: true, verbose: true,skip_import_validation:true)
else
    pod_push(path: spec_path, repo: "#{pod_repoName}", sources: [czsource,osource], allow_warnings: true, verbose: true,skip_import_validation:true)
end


#---------------------------------è·³è¿‡éªŒè¯ pod æ˜¯å¦å¯ä»¥å¯¼å…¥------------------#
#pod_lib_lint(sources: [czsource,osource], allow_warnings: true, verbose: true,skip_import_validation:true)
#pod_push(path: spec_path, repo: "CZSpecs", sources: [czsource,osource], allow_warnings: true, verbose: true,skip_import_validation:true)

#pod_lib_lint(sources: [czsource,osource], allow_warnings: true, verbose: true,skip_import_validation:true)
#pod_push(path: spec_path, repo: "CZSpecs", sources: [czsource,osource], allow_warnings: true, verbose: true,skip_import_validation:true)

#---------------------------------åŒ…å«é™æ€åº“çš„-  å½“ç„¶ ä¹Ÿå¯ä»¥å’Œ skip_import_validation ç»„åˆä½¿ç”¨-----------------#
#pod_lib_lint(sources: [czsource,osource], allow_warnings: true, verbose: true,use_libraries:true)
#pod_push(path: spec_path, repo: "CZSpecs", sources: [czsource,osource], allow_warnings: true, verbose: true,use_libraries:true)

# wm: å¦‚æœä»¥ä¸ŠæœªåŒ…å«å…¨éƒ¨ï¼Œåˆ™è¯·ç§»æ­¥  http://docs.fastlane.tools/actions/pod_lib_lint/ æŸ¥çœ‹å¯¹åº”çš„å‚æ•°


end
